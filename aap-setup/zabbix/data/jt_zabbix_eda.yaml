---
default:
  jt:
    organization: Default
    project: aap-demo
  wf:
    organization: Default

jt:
  - name: EDA_0000_シナリオ操作
    organization: "{{ default.jt.organization }}"
    project: "{{ default.jt.project }}"
    playbook: zabbix-eda/playbooks/scenario_ctrl.yaml
    inventory: docker-host
    credentials:
      - docker-server
    survey_enabled: true
    survey_spec:
      name: 実行するシナリオを指定
      description: ""
      spec:
        - question_name: シナリオを選択
          variable: senario_num
          type: multiplechoice
          choices:
            - "1"
            - "2"
            - "3"
          default: "1"
          required: true
        - question_name: 開始/停止
          variable: senario_mode
          type: multiplechoice
          choices:
            - start
            - end
          default: start
          required: true

  - name: EDA_0001_チケットオープン
    organization: "{{ default.jt.organization }}"
    project: "{{ default.jt.project }}"
    playbook: zabbix-eda/playbooks/redmine_create_issue.yaml
    inventory: localhost
    credentials:
      - redmine

  - name: EDA_0002_状態確認とチケット追記
    organization: "{{ default.jt.organization }}"
    project: "{{ default.jt.project }}"
    playbook: zabbix-eda/playbooks/redmine_check_status_and_add_log.yaml
    inventory: docker-host
    credentials:
      - docker-server
      - redmine
    become_enabled: true

  - name: EDA_0003a_チケットへの結果追加
    organization: "{{ default.jt.organization }}"
    project: "{{ default.jt.project }}"
    playbook: zabbix-eda/playbooks/redmine_add_comment_success.yaml
    inventory: localhost
    credentials:
      - redmine

  - name: EDA_0003b_チケットクローズ
    organization: "{{ default.jt.organization }}"
    project: "{{ default.jt.project }}"
    playbook: zabbix-eda/playbooks/redmine_add_comment_success.yaml
    inventory: localhost
    credentials:
      - redmine

  - name: EDA_0004_チケットクローズ
    organization: "{{ default.jt.organization }}"
    project: "{{ default.jt.project }}"
    playbook: zabbix-eda/playbooks/redmine_add_comment_faild.yaml
    inventory: localhost
    credentials:
      - redmine

  - name: EDA_0005_復旧停止を通知
    organization: "{{ default.jt.organization }}"
    project: "{{ default.jt.project }}"
    playbook: zabbix-eda/playbooks/redmine_add_comment_deny.yaml
    inventory: localhost
    credentials:
      - redmine

wf:
  - name: EDA_Zabbix_Auto_Response
    organization: "{{ default.wf.organization }}"
    extra_vars:
      zabbix_url: http://172.31.47.250:8080/
      project_id: 1
      tracker_id: 1
    survey_spec:
      name: EDAから受け取る変数を指定
      description: ""
      spec:
        - question_name: z_host_name
          variable: z_host_name
          type: text
          min: 0
          max: 1024
          required: true
        - question_name: z_host_id
          variable: z_host_id
          type: integer
          min: 0
          max: 1024
          required: true

    workflow_nodes:
      - identifier: チケットオープン
        unified_job_template:
          name: EDA_0001_チケットオープン
          type: job_template
        related:
          success_nodes: ["初期状態確認"]
          failure_nodes: []
          always_nodes: []
      - identifier: 初期状態確認
        unified_job_template:
          name: EDA_0002_状態確認とチケット追記
          type: job_template
        related:
          success_nodes: []
          failure_nodes: []
          always_nodes: []
