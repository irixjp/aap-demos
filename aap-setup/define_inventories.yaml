---
- name: define inventories {{ lp_inv.inv.name }}
  ansible.controller.inventory:
    name: "{{ lp_inv.inv.name }}"
    description: "{{ lp_inv.inv.description | default(omit) }}"
    organization: "{{ lp_inv.inv.organization | default(inventories.default.inv.organization) }}"
    state: "{{ lp_inv.inv.state | default(inventories.default.inv.state) }}"
  when: lp_inv.inv is defined

- name: define host in {{ lp_inv.inv.name }}
  ansible.controller.host:
    name: "{{ item.name }}"
    description: "{{ item.description | default(omit) }}"
    inventory: "{{ lp_inv.inv.name }}"
    variables: "{{ item.variables | default(omit) }}"
    state: "{{ item.state | default(inventories.default.hosts.state) }}"
  loop: "{{ lp_inv.hosts }}"
  when: lp_inv.hosts is defined

- name: define source invenry in {{ lp_inv.inv.name }}
  ansible.controller.inventory_source:
    name: "{{ item.name | default(item.source_path) }}"
    description: "{{ item.description | default(omit) }}"
    inventory: "{{ lp_inv.inv.name }}"
    source_path: "{{ item.source_path }}"
    state: "{{ item.state | default(default.src.state) }}"
    overwrite: "{{ item.overwrite | default(default.src.overwrite) }}"
    overwrite_vars: "{{ item.overwrite_vars | default(default.src.overwrite_vars) }}"
    update_on_launch: "{{ item.update_on_launch | default(default.src.update_on_launch) }}"
    source: "{{ item.source | default(default.src.source) }}"
    source_project: "{{ item.src.source_project | default(default.src.source_project) }}"
  loop: "{{ lp_inv.src }}"
  when: lp_inv.src is defined
